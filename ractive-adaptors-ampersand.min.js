(function(e,t){"use strict";if(typeof module!=="undefined"&&module.exports&&typeof require==="function"){module.exports=t()}else if(typeof define==="function"&&define.amd){define(t)}else{window.RactiveAdaptorsAmpersand=t()}})(typeof window!=="undefined"?window:this,function(){"use strict";var e="_ractiveAdaptorsAmpersandLock";var t,n,i;function o(t){t[e]=(t[e]||0)+1;return function n(){t[e]-=1;if(!t[e]){delete t[e]}}}function r(t){return!!t[e]}function u(e){return e&&typeof e.getType==="function"&&e.getType()===e[e.typeAttribute]}t={filter:function(e){return e&&(e.isCollection||u(e))},wrap:function(e,t,o,r){if(t.isCollection){return new i(e,t,o,r)}else{return new n(e,t,o,r)}}};n=function(e,t,n,i){this.value=t;t.on("change",this.modelChangeHandler=function(){var n=o(t);e.set(i(t.changedAttributes()));n()})};n.prototype={teardown:function(){this.value.off("change",this.modelChangeHandler)},get:function(){return this.value},set:function(e,t){if(!r(this.value)&&e.indexOf(".")===-1){if(this.value.get(e)===t){return}this.value.set(e,t)}},reset:function(e){if(u(e)||!(e instanceof Object)){return false}this.value.set(e)}};i=function(e,t,n){this.value=t;t.on("add remove reset sort",this.changeHandler=function(){var i=o(t);e.set(n,t.models);i()})};i.prototype={teardown:function(){this.value.off("add remove reset sort",this.changeHandler)},get:function(){return this.value.models},reset:function(e){if(r(this.value)){return}if(e.isCollection||Object.prototype.toString.call(e)!=="[object Array]"){return false}this.value.reset(e)}};return t});